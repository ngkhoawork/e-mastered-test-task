(this["webpackJsonpemastered-test-task"]=this["webpackJsonpemastered-test-task"]||[]).push([[0],{49:function(e,t,n){e.exports=n(82)},54:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(11),o=n.n(l),i=(n(54),n(55),n(18)),c=n(19),s=n(21),u=n(22),d=n(85),m=n(86),f=n(87),h=n(89),p=n(15),E=n(48),g=n(37),v=n.n(g),w=function(e){for(var t="",n=new Uint8Array(e),a=n.byteLength,r=0;r<a;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)},b=n(38),y=n.n(b);var S=function(){return new Promise((function(e){setTimeout((function(){var t=localStorage.getItem("audioFiles");if(t){var n=JSON.parse(t);e(n.map((function(e){return Object(E.a)({},e,{data:void 0})})))}else e([])}),1500)}))},C=function(e){return new Promise((function(t,n){var a=localStorage.getItem("audioFiles"),r=[];a&&(r=JSON.parse(a));var l=r.find((function(t,n){return t.id===e}));if(l){var o=new AudioContext,i=function(e){for(var t=window.atob(e),n=t.length,a=new Uint8Array(n),r=0;r<n;r++)a[r]=t.charCodeAt(r);return a.buffer}(l.data);o.decodeAudioData(i,(function(e){var t,n,a,r=e.length,o=e.duration,i=function(e){return{channels:e.numberOfChannels,buffers:(t=0,n=e.numberOfChannels-1,Array.apply(null,{length:n-t+1}).map((function(e,n){return n+t}))).map((function(t){for(var n=e.getChannelData(t),a=n.length,r=0,l=new Int16Array(a);r<a;)l[r]=o(n[r++]);function o(e){var t=e<0?32768*e:32767*e;return Math.max(-32768,Math.min(32768,t))}return l})),sampleRate:e.sampleRate,length:e.length};var t,n}(function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,a=(new AudioContext).createBuffer(e.numberOfChannels,n-t,e.sampleRate),r=0;r<e.numberOfChannels;r++)a.copyToChannel(e.getChannelData(r).slice(t,n),r);return a}(e,~~(0*r/o),~~(5*r/o)));!function(e,t){var n=document.createElement("a");n.href=e,n.download=t,n.click()}(function(e,t,n){for(var a=new y.a.Mp3Encoder(e,t,128),r=[],l=0;l<n[0].length;l+=1152){var o=n[0].subarray(l,l+1152),i=n[1].subarray(l,l+1152),c=a.encodeBuffer(o,i);c.length>0&&r.push(c)}var s=a.flush();s.length>0&&r.push(s);var u=new Blob(r,{type:"audio/mp3"});return window.URL.createObjectURL(u)}(i.channels,i.sampleRate,i.buffers),(t="mastered-".concat(l.name),n="mp3","".concat(t.replace(/\.\w+$/,"")).concat(a||"",".").concat(n)))}),(function(e){console.log("Error with decoding audio data"+e.err)}))}else n(new Error("Invalid file id"))}))},O=function(e){return new Promise((function(t,n){try{var a=localStorage.getItem("audioFiles"),r=[];a&&(r=JSON.parse(a));var l=v.a.filter(r,(function(t){return t.id!==e}));localStorage.setItem("audioFiles",JSON.stringify(l)),t({success:!0,fileId:e})}catch(o){n(o)}}))},F=n(88),k=function(e){var t=e.show,n=e.title,a=e.message,l=e.handleClose,o=e.handleSubmit;return r.a.createElement(F.a,{show:t,onHide:l,animation:!1,"data-testid":"confirmation-modal"},r.a.createElement(F.a.Header,{closeButton:!0},r.a.createElement(F.a.Title,null,n)),r.a.createElement(F.a.Body,null,a),r.a.createElement(F.a.Footer,null,r.a.createElement(h.a,{variant:"secondary",onClick:l,"data-testid":"cancel-button"},"Cancel"),r.a.createElement(h.a,{variant:"primary",onClick:o,"data-testid":"ok-button"},"Ok")))},D=n(84),A=function(e){Object(u.a)(n,e);var t=Object(s.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.files,a=t.isLoading;return r.a.createElement(D.a,{striped:!0,bordered:!0,hover:!0,size:"sm",responsive:!0,"data-testid":"file-list"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"File Id"),r.a.createElement("th",null,"File Name"),r.a.createElement("th",null,"File Size"),r.a.createElement("th",null,"Created"),r.a.createElement("th",null,"Action"))),r.a.createElement("tbody",null,a?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:5,align:"center"},"Loading...")):n.map((function(t){return r.a.createElement("tr",{key:t.id},r.a.createElement("td",null,t.id),r.a.createElement("td",null,t.name),r.a.createElement("td",null,"".concat((t.size/1024).toFixed(2)," KB")),r.a.createElement("td",null,new Date(t.created).toDateString()),r.a.createElement("td",null,r.a.createElement(h.a,{variant:"success",size:"sm",className:"mr-2",onClick:function(){return e.props.onDownload(t.id)}},r.a.createElement(p.b,null)),r.a.createElement(h.a,{variant:"danger",size:"sm",onClick:function(){return e.props.onDelete(t.id)}},r.a.createElement(p.c,null))))}))))}}]),n}(a.PureComponent),M=n(46),I=n(47),j=(n(81),function(){var e=Object(a.useState)(!1),t=Object(M.a)(e,2),n=t[0],l=t[1],o=Object(a.useCallback)((function(e){l(!0);var t=e.map((function(e){return function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.onerror=n,a.readAsArrayBuffer(e)}))}(e).then((function(t){return function(e){return new Promise((function(t){var n=localStorage.getItem("audioFiles"),a=[];n&&(a=JSON.parse(n)),a.push(e),localStorage.setItem("audioFiles",JSON.stringify(a)),t({success:!0,fileId:e.id})}))}({id:"_"+Math.random().toString(36).substr(2,9),name:e.name,size:e.size,data:w(t),created:Date.now()})}))}));Promise.all(t).then((function(e){l(!1)})).catch((function(e){console.log(e),l(!1)}))}),[]),i=Object(I.a)({accept:"audio/*",onDrop:o}),c=i.getRootProps,s=i.getInputProps,u=i.isDragActive;return r.a.createElement("div",{"data-testid":"file-uploader"},r.a.createElement("div",c({className:"dropzone"}),r.a.createElement("input",Object.assign({},s(),{"data-testid":"file-input"})),n?r.a.createElement("h4",null,"Uploading files..."):u?r.a.createElement("p",null,"Drop the files here ..."):[r.a.createElement("p",{key:"description"},"Drag 'n' drop some files here, or click to select files"),r.a.createElement("em",{key:"type-description"},"(Only audio files will be accepted)")]))}),N=function(e){Object(u.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={audioFiles:[],isUploading:!1,isLoading:!0,isShowConfirmationModal:!1,currentFileId:null},e.loadFiles=function(){e.setState({isLoading:!0}),S().then((function(t){e.setState({audioFiles:t,isLoading:!1})})).catch((function(e){console.err(e)}))},e.showModal=function(){return e.setState({isShowConfirmationModal:!0})},e.closeModal=function(){return e.setState({isShowConfirmationModal:!1})},e.handleUpload=function(e){},e.handleDownload=function(e){C(e)},e.handleDelete=function(t){e.closeModal(),O(e.state.currentFileId).then((function(t){e.loadFiles()}))},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.loadFiles()}},{key:"render",value:function(){var e=this,t=this.state,n=t.audioFiles,a=t.isLoading,l=t.isShowConfirmationModal;return r.a.createElement(d.a,{"data-testid":"homepage"},r.a.createElement("h1",{className:"my-5"},"E-Mastered Online Audio Manager"),r.a.createElement(m.a,null,r.a.createElement(f.a,null,r.a.createElement("h2",null,"Upload New File"))),r.a.createElement(m.a,null,r.a.createElement(f.a,null,r.a.createElement(j,null))),r.a.createElement(m.a,{className:"mt-5"},r.a.createElement(f.a,{sm:"9"},r.a.createElement("h2",null,"Uploaded Audio files")),r.a.createElement(f.a,{sm:"3",className:"text-right pt-2"},r.a.createElement(h.a,{variant:"outline-secondary",size:"sm",onClick:this.loadFiles},r.a.createElement(p.a,null)))),r.a.createElement(A,{isLoading:a,files:n,onDelete:function(t){e.setState({currentFileId:t}),e.showModal()},onDownload:this.handleDownload}),r.a.createElement(k,{show:l,title:"Wait!",message:"Are you sure to remove this file?",handleClose:this.closeModal,handleSubmit:this.handleDelete}))}}]),n}(a.Component);var L=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(N,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[49,1,2]]]);
//# sourceMappingURL=main.ff27bf25.chunk.js.map